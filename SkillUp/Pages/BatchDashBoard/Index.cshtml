@page
@model SkillUp.Pages.BatchDashBoard.IndexModel
@{
    ViewData["Title"] = "Batch";
    Layout = null;
}
<head>
    <title>Batch Index</title>
    <link rel="stylesheet" href="~/css/Batch.css">
</head>
<body>
    <script>
                async function confirmDeactivate(batchId) {
            if (confirm("Are you sure you want to delete this Batch?")) {
                try {
                        const response = await fetch(`https://localhost:7202/api/batch/${batchId}`, {
                        method: 'DELETE'
                    });

                    if (response.status === 204) {
                            alert("Batch deactiveted successfully.");
                        location.reload();
                    } else {
                        alert("Failed to delete bactch. Please try again.");
                    }
                } catch (error) {
                    console.error("Error during deletion:", error);
                    alert("An error occurred. Please try again.");
                }
            }
        }
        async function confirmActive(batchId) {
            try {
                const response = await fetch(`https://localhost:7202/api/batch/${batchId}`, {
                    method: 'PATCH'
                });

                if (response.ok) {
                    alert("Batch activated successfully.");
                    location.reload();
                } else {
                    alert("Failed to activate batch. Please try again.");
                }
            } catch (error) {
                console.error("Error during activation:", error);
                alert("An error occurred. Please try again.");
            }
        }
    </script>
    <h1>Batch Management</h1>
    <p>
        <a class="btn btn-primary" asp-page="CreateOrEdit">Create Batch</a>
    </p>

    <!-- Table for displaying batch data -->
    <div style="overflow-x: auto; overflow-y: auto; max-height: 400px; border: 1px solid #dee2e6; padding: 10px;">
        <table class="table">
            @if (Model.Batches != null && Model.Batches.Any())
            {
                <thead>
                    <tr>
                        <th>Batch Name</th>
                        <th>Is Active</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var batch in Model.Batches)
                    {
                        <tr>
                            <td>@batch.Name</td>
                            <td>@batch.IsActive</td>
                            <td>
                                @if (batch.IsActive)
                                {
                                    <a class="btn btn-warning" >Edit</a>
                                    <button class="btn btn-danger" type="button" onclick="confirmDeactivate(@batch.Id)">Deactivate</button>
                                }
                                else
                                {
                                    <button class="btn btn-secondary" type="button" onclick="confirmActive(@batch.Id)">Activate</button>
                                }
                            </td>
                        </tr>
                    }

                </tbody>
            }
            else
            {
                <tr>
                    <td colspan="3" style="text-align: center; padding: 20px;">No data available</td>
                </tr>
            }
        </table>
    </div>
</body>
